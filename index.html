<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>P2P Messenger | –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><defs><linearGradient id=%22g%22 x1=%220%22 y1=%220%22 x2=%221%22 y2=%221%22><stop offset=%220%22 stop-color=%22%230084ff%22/><stop offset=%221%22 stop-color=%22%23b300ff%22/></linearGradient></defs><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22url(%23g)%22/><path d=%22M30 40 L50 60 L70 40 M30 55 L50 75 L70 55%22 stroke=%22white%22 stroke-width=%228%22 fill=%22none%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22/></svg>">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <div id="toast">‚úÖ –ì–æ—Ç–æ–≤–æ!</div>

    <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è / –í—Ö–æ–¥ -->
    <div id="setup-overlay" class="overlay" style="display: none;">
        <div class="modal">
            <h1 id="setupTitle">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h1>
            <div class="setup-tabs" style="display:flex; gap:10px; margin-bottom:20px;">
                <button class="btn-main active" id="modeReg" onclick="app.setSetupMode('reg')"
                    style="height:35px; font-size:14px;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                <button class="btn-main" id="modeLogin" onclick="app.setSetupMode('login')"
                    style="height:35px; font-size:14px; background:#252525;">–í—Ö–æ–¥</button>
            </div>

            <p id="setupDesc">–í—ã–±–µ—Ä–∏—Ç–µ –∏–º—è, —Ü–≤–µ—Ç –∏ –ø–∞—Ä–æ–ª—å</p>

            <div class="color-picker" id="setupColors">
                <div class="color-dot active" style="background: #ff4d4d;" data-color="#ff4d4d"></div>
                <div class="color-dot" style="background: #4dff4d;" data-color="#4dff4d"></div>
                <div class="color-dot" style="background: #0084ff;" data-color="#0084ff"></div>
                <div class="color-dot" style="background: #ffaa00;" data-color="#ffaa00"></div>
                <div class="color-dot" style="background: #b300ff;" data-color="#b300ff"></div>
            </div>

            <input type="text" id="setupName" class="big-input" placeholder="–ù–∏–∫–Ω–µ–π–º" maxlength="20">
            <input type="password" id="setupPass" class="big-input" placeholder="–ü–∞—Ä–æ–ª—å">
            <input type="password" id="setupSecretInput" class="big-input" placeholder="–ö–ª—é—á –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
                style="display:none;">

            <div id="setup-secret-box"
                style="display:none; background:var(--glass); padding:10px; border-radius:8px; margin-top:10px; text-align:center;">
                <p style="font-size:12px; color:var(--text-dim); margin-bottom:5px;">üõ°Ô∏è –ö–ª—é—á –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–±–µ–∑ –Ω–µ–≥–æ –Ω–µ
                    –≤–æ–π—Ç–∏):</p>
                <button class="btn-main" style="height:35px; font-size:13px; background:var(--accent);"
                    onclick="navigator.clipboard.writeText(app.tempSecret || app.mySecret); app.showToast('–ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! üÜî')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    –ö–ª—é—á</button>
            </div>

            <div style="display:flex; gap:10px; margin-top:20px;">
                <button id="setupBtn" class="btn-main" style="flex:2" onclick="app.finishSetup()">–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É</button>
                <button class="btn-main" style="flex:1; background:#252525;" onclick="app.importData()">–ò–º–ø–æ—Ä—Ç</button>
            </div>
            <div id="setupError" style="color:var(--danger); font-size:12px; margin-top:10px;"></div>
        </div>
    </div>

    <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ IP / –ù–æ–≤–æ–µ –º–µ—Å—Ç–æ -->
    <div id="ip-overlay" class="lock-screen" style="display: none;">
        <div class="avatar"
            style="width:80px; height:80px; font-size:32px; margin-bottom:20px; background:var(--danger)">üõ°Ô∏è</div>
        <h2>–ù–æ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ?</h2>
        <p style="color:var(--text-dim); margin-bottom:30px; text-align:center; max-width:300px;">–ú—ã –∑–∞–º–µ—Ç–∏–ª–∏ –≤—Ö–æ–¥ —Å
            –Ω–æ–≤–æ–≥–æ IP –∏–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞. –í–≤–µ–¥–∏—Ç–µ –≤–∞—à <b>–ö–ª—é—á –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</b>.</p>
        <div style="max-width:300px; width:90%;" id="ipFirstStep">
            <button class="btn-main" style="margin-bottom:12px;" onclick="app.show2faStep('key')">üîë –°–µ–∫—Ä–µ—Ç–Ω—ã–π
                –ö–ª—é—á</button>
            <button class="btn-main" style="background:#0088cc; margin-bottom:12px;" id="btnTgCodeReq"
                onclick="app.requestTg2fa()">‚úàÔ∏è –ö–æ–¥ –≤ Telegram</button>
        </div>

        <div style="max-width:300px; width:90%; display:none;" id="ipKeyInputStep">
            <input type="password" id="ipSecretInput" class="big-input" placeholder="–í–∞—à —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á">
            <button class="btn-main" onclick="app.verifySecret()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            <button class="btn-main" style="background:transparent; font-size:12px; margin-top:10px;"
                onclick="app.show2faStep('choice')">‚Üê –ù–∞–∑–∞–¥</button>
            <div id="ipError" style="color:var(--danger); font-size:12px; margin-top:10px; text-align:center;"></div>
        </div>

        <div style="max-width:300px; width:90%; display:none;" id="ipTgInputStep">
            <p style="font-size:12px; color:var(--text-dim); margin-bottom:10px;">–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram –±–æ—Ç—É.</p>
            <input type="text" id="ipTgCodeInput" class="big-input" placeholder="6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥" maxlength="6">
            <button class="btn-main" onclick="app.verifyTg2fa()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ö–æ–¥</button>
            <button class="btn-main" style="background:transparent; font-size:12px; margin-top:10px;"
                onclick="app.show2faStep('choice')">‚Üê –ù–∞–∑–∞–¥</button>
            <div id="tgIpError" style="color:var(--danger); font-size:12px; margin-top:10px; text-align:center;"></div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ -->
    <div id="lock-overlay" class="lock-screen" style="display: none;">
        <div class="avatar" id="lockAvatar" style="width:80px; height:80px; font-size:32px; margin-bottom:20px;">?</div>
        <h2 id="lockNick">–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º</h2>
        <p style="color:var(--text-dim); margin-bottom:30px;">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞</p>
        <div style="max-width:300px; width:90%;">
            <input type="password" id="lockPass" class="big-input" placeholder="–ü–∞—Ä–æ–ª—å"
                onkeypress="if(event.key==='Enter') app.unlock()">
            <button class="btn-main" onclick="app.unlock()">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
            <div id="lockError" style="color:var(--danger); font-size:12px; margin-top:10px; text-align:center;"></div>
        </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div id="settings-overlay" class="overlay" style="display: none;"
        onclick="if(event.target===this) this.style.display='none'">
        <div class="modal">
            <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
            <p>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Ñ–∏–ª—å</p>
            <input type="text" id="editName" class="big-input" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">

            <div style="margin: 15px 0; border-top: 1px solid var(--border); padding-top: 15px;">
                <p style="font-size:12px; color:var(--text-dim); margin-bottom:10px; text-align:left;">–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    –¥–∞–Ω–Ω—ã—Ö –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å:</p>
                <input type="password" id="oldPass" class="big-input" placeholder="–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å">
            </div>

            <div style="margin: 15px 0;">
                <p style="font-size:12px; color:var(--text-dim); margin-bottom:10px; text-align:left;">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
                    (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ –º–µ–Ω—è–µ—Ç–µ):</p>
                <input type="password" id="editPass" class="big-input" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
            </div>

            <div class="settings-section"
                style="text-align:left; margin-top:20px; border-top:1px solid var(--border); padding-top:15px;">
                <h3 style="font-size:14px; margin-bottom:10px;">üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>

                <label class="switch-item"
                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; cursor:pointer;">
                    <span style="font-size:13px;">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ IP</span>
                    <input type="checkbox" id="settingIpCheck" onchange="app.toggleIpCheck(this.checked)">
                </label>

                <p id="keyWarning"
                    style="color:var(--danger); font-size:12px; margin:10px 0; font-weight:bold; display:none;">
                    üî¥ –í–ù–ò–ú–ê–ù–ò–ï: –ï—Å–ª–∏ –≤—ã –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –ö–ª—é—á –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –¥–æ—Å—Ç—É–ø –∫ –∞–∫–∫–∞—É–Ω—Ç—É –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω!
                </p>

                <button class="btn-main" style="background:var(--accent); margin-bottom:10px;"
                    onclick="navigator.clipboard.writeText(app.mySecret); app.showToast('–ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! üÜî')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    –ö–ª—é—á</button>

                <h3 style="font-size:14px; margin:20px 0 10px;">ü§ñ Telegram 2FA (@p2p2fabot)</h3>
                <label class="switch-item"
                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; cursor:pointer;">
                    <span style="font-size:13px;">–í–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
                    <input type="checkbox" id="settingTgEnabled" onchange="app.toggleTg(this.checked)">
                </label>

                <div id="tgSettings"
                    style="display:none; background:var(--glass); padding:10px; border-radius:10px; margin-top:10px;">
                    <div id="tgPairingContainer">
                        <p id="tgPairingCodeDisplay"
                            style="font-size:18px; font-weight:bold; color:var(--accent); letter-spacing:3px; margin:10px 0; display:none;">
                            - - - - - -</p>
                        <p id="tgPairingStatus" style="font-size:12px; color:var(--text-dim); margin-bottom:10px;">
                            –ü—Ä–∏–≤—è–∂–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å 2FA –∏ –∫–æ–º–∞–Ω–¥—ã (<b>/logout</b>).</p>
                        <button id="tgPairBtn" class="btn-main" style="height:35px; font-size:13px; background:#0088cc;"
                            onclick="app.startTgPairing()">–ü—Ä–∏–≤—è–∑–∞—Ç—å —á–µ—Ä–µ–∑ –ö–æ–¥</button>
                    </div>
                    <div id="tgLinkedContainer" style="display:none;">
                        <p style="font-size:12px; color:var(--text-dim);">–°—Ç–∞—Ç—É—Å: <span
                                style="color:#4dff4d;">–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</span></p>
                        <p style="font-size:11px; color:var(--text-dim); margin-bottom:10px;">Chat ID: <span
                                id="tgChatIdLabel">?</span></p>
                        <button class="btn-main" style="height:35px; font-size:13px; background:var(--danger);"
                            onclick="app.unlinkTg()">–û—Ç–∫–ª—é—á–∏—Ç—å</button>
                    </div>
                </div>
            </div>

            <div style="display:flex; gap:10px; margin-top:20px; border-top:1px solid var(--border); padding-top:15px;">
                <button class="btn-main" style="flex:1" onclick="app.updateProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn-main" style="flex:1; background:#252525;" onclick="app.exportData()">–≠–∫—Å–ø–æ—Ä—Ç</button>
                <button class="btn-main" style="flex:1; background:#252525;" onclick="app.importData()">–ò–º–ø–æ—Ä—Ç</button>
            </div>
            <button class="btn-main" style="background:#252525; margin-top:10px; font-size:13px;"
                onclick="app.logout()">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
            <button class="btn-main" style="background:var(--danger); margin-top:10px; font-size:13px;"
                onclick="app.clearData()">–£–¥–∞–ª–∏—Ç—å –≤—Å—ë (—Å –∏—Å—Ç–æ—Ä–∏–µ–π)</button>
        </div>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="profile-header">
            <div class="avatar" id="myAvatarDisplay">?</div>
            <div class="profile-info">
                <h2 id="myNickDisplay">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
                <small onclick="app.copyMyId()">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID</small>
            </div>
            <div class="btn-settings" onclick="app.openSettings()">‚öôÔ∏è</div>
        </div>

        <div class="search-container">
            <input type="text" id="contactSearch" placeholder="–ü–æ–∏—Å–∫ –∏–ª–∏ –≤–≤–æ–¥ ID..."
                onkeypress="if(event.key==='Enter') app.tryAddFriend()">
        </div>

        <div class="contact-list" id="contactList">
            <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
        </div>

        <div style="padding: 16px;">
            <button class="btn-main" onclick="app.shareInvite()">üîó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π</button>
        </div>
    </div>

    <div class="chat-area">
        <div class="chat-header">
            <div class="btn-back" onclick="app.toggleSidebar()">‚Üê</div>
            <div class="avatar" style="width:36px; height:36px; font-size:14px;" id="chatAvatar">?</div>
            <div class="chat-header-info">
                <h3 id="chatName">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</h3>
                <span id="chatStatus">...</span>
            </div>
            <div id="chatSafety" class="fingerprint" style="margin-left:auto; display:none;"
                onclick="app.showSafetyInfo()">
                üîí <span id="fingerprintValue"></span>
            </div>
        </div>

        <div id="messages">
            <div class="sys-msg" style="margin-top:auto;">–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ, –≤—ã–±—Ä–∞–≤ –∫–æ–Ω—Ç–∞–∫—Ç –∏–ª–∏ –¥–æ–±–∞–≤–∏–≤ –ø–æ ID</div>
        </div>

        <div class="input-bar">
            <input type="text" id="msgInput" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
                onkeypress="if(event.key==='Enter') app.sendMessage()" disabled>
            <button id="sendBtn" class="btn-send" onclick="app.sendMessage()" disabled>‚û§</button>
        </div>
    </div>

    <script src="js/app.js" defer></script>
</body>

</html>