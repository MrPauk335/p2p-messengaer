<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>P2P Messenger | –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><defs><linearGradient id=%22g%22 x1=%220%22 y1=%220%22 x2=%221%22 y2=%221%22><stop offset=%220%22 stop-color=%22%230084ff%22/><stop offset=%221%22 stop-color=%22%23b300ff%22/></linearGradient></defs><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22url(%23g)%22/><path d=%22M30 40 L50 60 L70 40 M30 55 L50 75 L70 55%22 stroke=%22white%22 stroke-width=%228%22 fill=%22none%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22/></svg>">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css?v=1.1">
    <link rel="manifest" href="manifest.json?v=1.1">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>

<body>

    <div id="toast">‚úÖ –ì–æ—Ç–æ–≤–æ!</div>
    <div id="sidebar-backdrop"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:900; backdrop-filter:blur(2px);"
        onclick="app.toggleSidebar()"></div>

    <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è / –í—Ö–æ–¥ -->
    <div id="setup-overlay" class="overlay" style="display: none;">
        <div class="modal">
            <h1 id="setupTitle">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h1>
            <div class="setup-tabs" style="display:flex; gap:10px; margin-bottom:20px;">
                <button class="btn-main active" id="modeReg" onclick="app.setSetupMode('reg')"
                    style="height:35px; font-size:14px;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                <button class="btn-main" id="modeLogin" onclick="app.setSetupMode('login')"
                    style="height:35px; font-size:14px; background:#252525;">–í—Ö–æ–¥</button>
                <button class="btn-main" id="modeSync" onclick="app.startPreLoginSync()"
                    style="height:35px; font-size:14px; background:#0084ff;">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω.</button>
            </div>

            <p id="setupDesc">–í—ã–±–µ—Ä–∏—Ç–µ –∏–º—è, —Ü–≤–µ—Ç –∏ –ø–∞—Ä–æ–ª—å</p>

            <div class="color-picker" id="setupColors">
                <div class="color-dot active" style="background: #ff4d4d;" data-color="#ff4d4d"></div>
                <div class="color-dot" style="background: #4dff4d;" data-color="#4dff4d"></div>
                <div class="color-dot" style="background: #0084ff;" data-color="#0084ff"></div>
                <div class="color-dot" style="background: #ffaa00;" data-color="#ffaa00"></div>
                <div class="color-dot" style="background: #b300ff;" data-color="#b300ff"></div>
            </div>

            <input type="text" id="setupName" class="big-input" placeholder="–ù–∏–∫–Ω–µ–π–º" maxlength="20">
            <p style="font-size:10px; color:var(--danger); margin-top:-8px; margin-bottom:10px; opacity:0.8;">‚ö†Ô∏è
                –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞—Å–∫–ª–∞–¥–∫—É –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã!</p>
            <input type="password" id="setupPass" class="big-input" placeholder="–ü–∞—Ä–æ–ª—å">

            <div id="login-2fa-choice" style="display:none; margin-top:15px;">
                <p style="font-size:12px; color:var(--text-dim); margin-bottom:10px;">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –≤—Ö–æ–¥–∞:</p>
                <div style="display:flex; gap:10px;">
                    <button class="btn-main" style="flex:1; height:40px; font-size:13px;"
                        onclick="app.setLogin2fa('key')">üîë –ö–ª—é—á</button>
                    <button class="btn-main" style="flex:1; height:40px; font-size:13px; background:#0088cc;"
                        onclick="app.requestLoginTg()">‚úàÔ∏è Telegram</button>
                </div>
            </div>

            <input type="password" id="setupSecretInput" class="big-input" placeholder="–ö–ª—é—á –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
                style="display:none; margin-top:15px;">

            <div id="login-tg-wait"
                style="display:none; margin-top:15px; background:var(--glass); padding:10px; border-radius:10px;">
                <p style="font-size:12px; color:var(--text-dim);">–û—Ç–ø—Ä–∞–≤—å—Ç–µ <b>/login</b> –±–æ—Ç—É <a
                        href="https://t.me/p2p2fabot" target="_blank" style="color:var(--accent)">@p2p2fabot</a></p>
                <div id="loginTgStatus" style="font-size:11px; margin-top:5px; color:var(--accent);">–û–∂–∏–¥–∞–Ω–∏–µ
                    —Å–æ–æ–±—â–µ–Ω–∏—è...</div>
                <input type="text" id="setupTgCodeInput" class="big-input" placeholder="–ö–æ–¥ –∏–∑ Telegram" maxlength="6"
                    style="display:none; margin-top:10px;">
            </div>

            <div style="margin-top:20px; font-size:12px; color:var(--text-dim); text-align:center;">
                <a href="https://t.me/p2p2fabot" target="_blank" style="color:var(--accent); text-decoration:none;">üéß
                    –¢–µ—Ö. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            </div>

            <div id="setup-secret-box"
                style="display:none; background:var(--glass); padding:10px; border-radius:8px; margin-top:10px; text-align:center;">
                <p style="font-size:12px; color:var(--text-dim); margin-bottom:5px;">üõ°Ô∏è –ö–ª—é—á –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–±–µ–∑ –Ω–µ–≥–æ –Ω–µ
                    –≤–æ–π—Ç–∏):</p>
                <button class="btn-main" style="height:35px; font-size:13px; background:var(--accent);"
                    onclick="navigator.clipboard.writeText(app.tempSecret || app.mySecret); app.showToast('–ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! üÜî')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    –ö–ª—é—á</button>
            </div>

            <div style="display:flex; gap:10px; margin-top:20px;">
                <button id="setupBtn" class="btn-main" style="flex:2" onclick="app.finishSetup()">–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É</button>
                <button class="btn-main" style="flex:1; background:#252525;"
                    onclick="app.showSyncOverlay('target')">–°–∏–Ω—Ö—Ä–æ–Ω.</button>
                <button class="btn-main" style="flex:1; background:#252525;" onclick="app.importData()">–ò–º–ø–æ—Ä—Ç</button>
            </div>
            <div id="setupError" style="color:var(--danger); font-size:12px; margin-top:10px; text-align:center;"></div>

            <div style="margin-top:25px; border-top:1px solid var(--border); padding-top:15px; text-align:center;">
                <p style="font-size:11px; color:var(--text-dim); margin-bottom:5px;">–í–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã?</p>
                <button class="btn-main"
                    style="background:transparent; color:var(--danger); border:1px solid var(--danger); height:30px; font-size:11px; width:auto; padding:0 15px;"
                    onclick="app.clearData()">‚ö†Ô∏è –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë –∏ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
            </div>

            <div style="margin-top:30px; border-top:1px solid #333; padding-top:15px; width:100%; text-align:center;">
                <p style="font-size:11px; color:var(--text-dim); cursor:pointer; text-decoration:underline;"
                    onclick="app.clearData()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë –∏ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</p>
            </div>
        </div>
    </div>

    <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ IP / –ù–æ–≤–æ–µ –º–µ—Å—Ç–æ -->
    <div id="ip-overlay" class="lock-screen" style="display: none;">
        <div class="avatar"
            style="width:80px; height:80px; font-size:32px; margin-bottom:20px; background:var(--danger)">üõ°Ô∏è</div>
        <h2>–ù–æ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ?</h2>
        <p style="color:var(--text-dim); margin-bottom:30px; text-align:center; max-width:300px;">–ú—ã –∑–∞–º–µ—Ç–∏–ª–∏ –≤—Ö–æ–¥ —Å
            –Ω–æ–≤–æ–≥–æ IP –∏–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞. –í–≤–µ–¥–∏—Ç–µ –≤–∞—à <b>–ö–ª—é—á –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</b>.</p>
        <div style="max-width:300px; width:90%;" id="ipFirstStep">
            <button class="btn-main" style="margin-bottom:12px;" onclick="app.show2faStep('key')">üîë –°–µ–∫—Ä–µ—Ç–Ω—ã–π
                –ö–ª—é—á</button>
            <button class="btn-main" style="background:#0088cc; margin-bottom:12px;" id="btnTgCodeReq"
                onclick="app.requestTg2fa()">‚úàÔ∏è –ö–æ–¥ –≤ Telegram</button>
            <div style="max-width:300px; width:90%; color:var(--text-dim); margin-top:30px; font-size:13px;">
                <p style="cursor:pointer; text-decoration:underline;" onclick="app.logout(true)">–ó–∞–±—ã–ª–∏ –∫–ª—é—á? –°–±—Ä–æ—Å–∏—Ç—å
                    –≤—Ö–æ–¥</p>
                <p style="margin-top:10px;">
                    <a href="https://t.me/p2p2fabot" target="_blank"
                        style="color:var(--accent); text-decoration:none;">üéß –°–≤—è–∑–∞—Ç—å—Å—è —Å –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–µ–π</a>
                </p>
            </div>
        </div>

        <div style="max-width:300px; width:90%; display:none;" id="ipKeyInputStep">
            <input type="password" id="ipSecretInput" class="big-input" placeholder="–í–∞—à —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á">
            <button class="btn-main" onclick="app.verifySecret()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            <button class="btn-main" style="background:transparent; font-size:12px; margin-top:10px;"
                onclick="app.show2faStep('choice')">‚Üê –ù–∞–∑–∞–¥</button>
            <div id="ipError" style="color:var(--danger); font-size:12px; margin-top:10px; text-align:center;"></div>
        </div>

        <div style="max-width:300px; width:90%; display:none;" id="ipTgInputStep">
            <p style="font-size:12px; color:var(--text-dim); margin-bottom:10px;">–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram –±–æ—Ç—É.</p>
            <input type="text" id="ipTgCodeInput" class="big-input" placeholder="6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥" maxlength="6">
            <button class="btn-main" onclick="app.verifyTg2fa()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ö–æ–¥</button>
            <button class="btn-main" style="background:transparent; font-size:12px; margin-top:10px;"
                onclick="app.show2faStep('choice')">‚Üê –ù–∞–∑–∞–¥</button>
            <div id="tgIpError" style="color:var(--danger); font-size:12px; margin-top:10px; text-align:center;"></div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ -->
    <div id="lock-overlay" class="lock-screen" style="display: none;">
        <div class="avatar" id="lockAvatar" style="width:80px; height:80px; font-size:32px; margin-bottom:20px;">?</div>
        <h2 id="lockNick">–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º</h2>
        <p style="color:var(--text-dim); margin-bottom:30px;">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞</p>
        <div style="max-width:300px; width:90%;">
            <input type="password" id="lockPass" class="big-input" placeholder="–ü–∞—Ä–æ–ª—å"
                onkeypress="if(event.key==='Enter') app.unlock()">
            <button class="btn-main" onclick="app.unlock()">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
            <div id="lockError" style="color:var(--danger); font-size:12px; margin-top:10px; text-align:center;"></div>
            <p style="font-size:11px; color:var(--text-dim); margin-top:30px; cursor:pointer; text-decoration:underline; text-align:center;"
                onclick="app.logout(true)">–°–±—Ä–æ—Å–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∞–∫–∫–∞—É–Ω—Ç</p>
        </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div id="settings-overlay" class="overlay" style="display: none;"
        onclick="if(event.target===this) this.style.display='none'">
        <div class="modal">
            <div style="position:absolute; top:20px; right:20px; font-size:24px; cursor:pointer; color:var(--text-dim);"
                onclick="document.getElementById('settings-overlay').style.display='none'">‚úï</div>
            <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ <span
                    style="font-size:10px; color:var(--text-dim); vertical-align:middle; margin-left:10px; font-weight:normal;">v1.1</span>
            </h1>
            <p>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Ñ–∏–ª—å</p>
            <div id="encryptionStatus" style="font-size:11px; margin-bottom:15px; font-weight:600;"></div>
            <input type="text" id="editName" class="big-input" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">

            <div id="syncRegistrySection"
                style="margin: 20px 0; background:rgba(0,132,255,0.08); padding:15px; border-radius:15px; border:1px solid rgba(0,132,255,0.3); box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                <h3 style="font-size:15px; margin:0 0 8px; color:#3fa9ff; display:flex; align-items:center; gap:8px;">
                    <span style="font-size:18px;">üîÑ</span> –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (Auto-Sync)
                </h3>
                <p style="font-size:11px; color:var(--text-dim); margin-bottom:12px; line-height:1.4;">–≠—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ
                    —Å–≤—è–∑–∞–Ω–æ. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º—ã –∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞.</p>
                <button class="btn-main"
                    style="background:var(--accent); font-size:14px; height:40px; box-shadow: 0 4px 10px rgba(0,132,255,0.3);"
                    onclick="app.showSyncOverlay('source')">–°–≤—è–∑–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</button>
            </div>

            <div style="margin: 15px 0; border-top: 1px solid var(--border); padding-top: 15px;">
                <p style="font-size:12px; color:var(--text-dim); margin-bottom:10px; text-align:left;">–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    –¥–∞–Ω–Ω—ã—Ö –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å:</p>
                <input type="password" id="oldPass" class="big-input" placeholder="–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å">
            </div>

            <div style="margin: 15px 0;">
                <p style="font-size:12px; color:var(--text-dim); margin-bottom:10px; text-align:left;">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
                    (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ –º–µ–Ω—è–µ—Ç–µ):</p>
                <input type="password" id="editPass" class="big-input" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
            </div>

            <div class="settings-section"
                style="text-align:left; margin-top:20px; border-top:1px solid var(--border); padding-top:15px;">

                <h3 style="font-size:14px; margin-bottom:10px;">üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>

                <label class="switch-item"
                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; cursor:pointer;">
                    <span style="font-size:13px;">–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ IP</span>
                    <input type="checkbox" id="settingIpCheck" onchange="app.toggleIpCheck(this.checked)">
                </label>

                <p id="keyWarning"
                    style="color:var(--danger); font-size:12px; margin:10px 0; font-weight:bold; display:none;">
                    üî¥ –í–ù–ò–ú–ê–ù–ò–ï: –ï—Å–ª–∏ –≤—ã –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –ö–ª—é—á –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –¥–æ—Å—Ç—É–ø –∫ –∞–∫–∫–∞—É–Ω—Ç—É –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω!
                </p>

                <button class="btn-main" style="background:var(--accent); margin-bottom:10px;"
                    onclick="navigator.clipboard.writeText(app.mySecret); app.showToast('–ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! üÜî')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                    –ö–ª—é—á</button>

                <h3 style="font-size:14px; margin:20px 0 10px;">ü§ñ Telegram 2FA (@p2p2fabot)</h3>
                <label class="switch-item"
                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; cursor:pointer;">
                    <span style="font-size:13px;">–í–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
                    <input type="checkbox" id="settingTgEnabled" onchange="app.toggleTg(this.checked)">
                </label>

                <div id="tgSettings"
                    style="display:none; background:var(--glass); padding:10px; border-radius:10px; margin-top:10px;">
                    <div id="tgPairingContainer">
                        <p id="tgPairingCodeDisplay"
                            style="font-size:18px; font-weight:bold; color:var(--accent); letter-spacing:3px; margin:10px 0; display:none;">
                            - - - - - -</p>
                        <p id="tgPairingStatus" style="font-size:12px; color:var(--text-dim); margin-bottom:10px;">
                            –ü—Ä–∏–≤—è–∂–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å 2FA –∏ –∫–æ–º–∞–Ω–¥—ã (<b>/logout</b>).</p>
                        <button id="tgPairBtn" class="btn-main" style="height:35px; font-size:13px; background:#0088cc;"
                            onclick="app.startTgPairing()">–ü—Ä–∏–≤—è–∑–∞—Ç—å —á–µ—Ä–µ–∑ –ö–æ–¥</button>
                    </div>
                    <div id="tgLinkedContainer" style="display:none;">
                        <p style="font-size:12px; color:var(--text-dim);">–°—Ç–∞—Ç—É—Å: <span
                                style="color:#4dff4d;">–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</span></p>
                        <p style="font-size:11px; color:var(--text-dim); margin-bottom:10px;">Chat ID: <span
                                id="tgChatIdLabel">?</span></p>
                        <button class="btn-main" style="height:35px; font-size:13px; background:var(--danger);"
                            onclick="app.unlinkTg()">–û—Ç–∫–ª—é—á–∏—Ç—å</button>
                    </div>
                </div>

                <h3 style="font-size:14px; margin:20px 0 10px;">‚ö° Fort Knox Mode</h3>
                <label class="switch-item"
                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; cursor:pointer;">
                    <span style="font-size:13px;">–†–µ–∂–∏–º –ò–Ω–∫–æ–≥–Ω–∏—Ç–æ (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é)</span>
                    <input type="checkbox" id="settingIncognito" onchange="app.toggleIncognito(this.checked)">
                </label>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <span style="font-size:13px;">–¢–∞–π–º–µ—Ä —É–¥–∞–ª–µ–Ω–∏—è (0 = –≤—ã–∫–ª)</span>
                    <select id="settingBurn" onchange="app.setBurnTimer(this.value)"
                        style="background:#1a1a1a; color:#fff; border:1px solid var(--border); border-radius:5px; padding:2px 5px;">
                        <option value="0">–í—ã–∫–ª</option>
                        <option value="10">10 —Å–µ–∫</option>
                        <option value="60">1 –º–∏–Ω</option>
                        <option value="300">5 –º–∏–Ω</option>
                        <option value="3600">1 —á–∞—Å</option>
                    </select>
                </div>

                <div id="p2pInstallContainer"
                    style="margin-top:20px; border-top:1px solid var(--border); padding-top:15px; display:none;">
                    <h3 style="font-size:14px; margin-bottom:10px;">üì± –ê–≤—Ç–æ–Ω–æ–º–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h3>
                    <p style="font-size:11px; color:var(--text-dim); margin-bottom:10px;">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –Ω–∞
                        —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª –∏–ª–∏ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∞.</p>
                    <button class="btn-main" style="background:var(--accent); font-size:13px; margin-bottom:10px;"
                        onclick="app.promptInstall()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Messenger</button>
                </div>
            </div>

            <div style="display:flex; gap:10px; margin-top:20px; border-top:1px solid var(--border); padding-top:15px;">
                <button class="btn-main" style="flex:1" onclick="app.updateProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn-main" style="flex:1; background:#252525;" onclick="app.exportData()">–≠–∫—Å–ø–æ—Ä—Ç</button>
                <button class="btn-main" style="flex:1; background:#252525;" onclick="app.importData()">–ò–º–ø–æ—Ä—Ç</button>
            </div>
            <button class="btn-main" style="background:#252525; margin-top:10px; font-size:13px;"
                onclick="app.logout()">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
            <button class="btn-main" style="background:var(--danger); margin-top:10px; font-size:13px;"
                onclick="app.clearData()">–£–¥–∞–ª–∏—Ç—å –≤—Å—ë (—Å –∏—Å—Ç–æ—Ä–∏–µ–π)</button>
        </div>
    </div>

    <!-- –î–µ—Ç–∞–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Safety Info) -->
    <div id="safety-overlay" class="overlay" style="display: none;"
        onclick="if(event.target===this) this.style.display='none'">
        <div class="modal" style="max-width: 400px;">
            <div style="position:absolute; top:20px; right:20px; font-size:24px; cursor:pointer; color:var(--text-dim);"
                onclick="document.getElementById('safety-overlay').style.display='none'">‚úï</div>
            <h2 id="safetyTitle">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —á–∞—Ç–∞</h2>
            <div id="safetyBadges" style="margin:15px 0;"></div>

            <div style="background:var(--glass); padding:15px; border-radius:15px; margin-bottom:20px;">
                <p style="font-size:12px; margin-bottom:10px; color:var(--text-dim);">–ö–æ–¥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Fingerprint):
                </p>
                <div id="safetyFingerprintDisplay" style="font-size:32px; letter-spacing:8px; margin-bottom:5px;"></div>
                <p style="font-size:11px; color:var(--text-dim);">–ï—Å–ª–∏ —ç—Ç–æ—Ç –∫–æ–¥ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–±–æ–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –ø–µ—Ä–µ—Ö–≤–∞—Ç
                    —Å–æ–æ–±—â–µ–Ω–∏–π –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω.</p>
            </div>

            <div style="text-align:left; font-size:12px; line-height:1.6; color:var(--text-dim); margin-bottom:20px;">
                <p>üîí <b>–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è:</b> ECDH P-256 (Handshake) + AES-GCM 256 (Payload)</p>
                <p>üõ°Ô∏è <b>Peer-to-Peer:</b> –ü—Ä—è–º–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–æ–≤.</p>
            </div>

            <div id="safetyVerifyContainer">
                <button id="btnVerify" class="btn-main" onclick="app.verifyContact()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ª–∏—á–Ω–æ—Å—Ç—å ‚úÖ</button>
            </div>
        </div>
    </div>

    <div class="app-container">
        <!-- 1st Column: Nav Rail (Discord style) -->
        <div class="nav-rail">
            <div class="rail-item active" id="rail-home" onclick="app.setContext('home')" title="–õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è">
                <div class="rail-icon">üè†</div>
            </div>
            <div class="rail-divider"></div>
            <div id="rail-groups">
                <!-- Groups will be injected here -->
            </div>
            <div class="rail-item add" onclick="document.getElementById('group-create-overlay').style.display='flex'"
                title="–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É">
                <div class="rail-icon">‚ûï</div>
            </div>
        </div>

        <div class="main-panes">
            <div class="sidebar" id="sidebar">
                <div class="profile-header">
                    <div class="avatar" id="myAvatarDisplay">?</div>
                    <div class="profile-info">
                        <h2 id="myNickDisplay">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
                        <small id="myIdDisplay" onclick="app.copyMyId()" style="cursor:pointer; opacity:0.7;">–ù–∞–∂–º–∏—Ç–µ,
                            —á—Ç–æ–±—ã
                            —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID</small>
                    </div>
                    <div class="btn-settings" onclick="app.openSettings()">‚öôÔ∏è</div>
                </div>

                <div class="search-container" style="display:flex; gap:10px; align-items:center;">
                    <!-- Dummy field to trick Chrome's autofill -->
                    <input type="text" style="display:none;" tabindex="-1">
                    <input type="password" style="display:none;" tabindex="-1">

                    <input type="text" id="contactSearch" placeholder="–ü–æ–∏—Å–∫ –∏–ª–∏ –≤–≤–æ–¥ ID..."
                        onkeypress="if(event.key==='Enter') app.tryAddFriend()" style="flex:1"
                        autocomplete="new-password" spellcheck="false" oninput="app.refreshContacts()"
                        name="p2p_search_v3" readonly onfocus="this.removeAttribute('readonly')">
                    <div class="btn-settings"
                        onclick="document.getElementById('group-create-overlay').style.display='flex'"
                        title="–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É" style="margin:0; font-size:18px;">üë•</div>
                </div>

                <div class="contact-list" id="contactList">
                    <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
                </div>

                <div style="padding: 16px;">
                    <button class="btn-main" onclick="app.shareInvite()">üîó –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π</button>
                </div>
            </div>

            <div class="chat-area" id="chatArea" style="display: none;">
                <div class="chat-header">
                    <div class="btn-back" onclick="app.toggleSidebar()">‚¨ÖÔ∏è</div>
                    <div class="avatar" style="width:36px; height:36px; font-size:14px;" id="chatAvatar">?</div>
                    <div class="chat-header-info">
                        <h3 id="chatName">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</h3>
                        <span id="chatStatus">...</span>
                    </div>
                    <div id="chatSafety" class="fingerprint" style="margin-left:auto; display:none;"
                        onclick="app.showSafetyInfo()">
                        <span id="fingerprintValue"></span>
                    </div>
                    <div id="membersToggle" class="btn-settings" style="display:none; font-size:18px;"
                        onclick="app.toggleMembersList()" title="–£—á–∞—Å—Ç–Ω–∏–∫–∏">üë•</div>
                </div>

                <div class="chat-main">
                    <div id="messages">
                        <div class="sys-msg" style="margin-top:auto;">–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ, –≤—ã–±—Ä–∞–≤ –∫–æ–Ω—Ç–∞–∫—Ç –∏–ª–∏ –¥–æ–±–∞–≤–∏–≤ –ø–æ ID
                        </div>
                    </div>

                    <div class="members-sidebar" id="membersSidebar" style="display:none;">
                        <h4>–£—á–∞—Å—Ç–Ω–∏–∫–∏</h4>
                        <div id="membersList"></div>
                    </div>
                </div>

                <div class="input-bar">
                    <input type="text" id="msgInput" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
                        onkeypress="if(event.key==='Enter') app.sendMessage()" disabled>
                    <button id="sendBtn" class="btn-send" onclick="app.sendMessage()" disabled>‚û§</button>
                </div>
            </div>

            <!-- Empty State -->
            <div id="emptyChat" class="chat-area empty-state">
                <div style="text-align:center;">
                    <div style="font-size: 64px; margin-bottom: 20px; opacity: 0.3;">üí¨</div>
                    <h2>–í—ã–±–µ—Ä–∏—Ç–µ, —Å –∫–µ–º –ø–æ–æ–±—â–∞—Ç—å—Å—è</h2>
                    <p style="color:var(--text-dim);">–í–∞—à–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞—â–∏—â–µ–Ω—ã —Å–∫–≤–æ–∑–Ω—ã–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º (E2EE)</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã -->
    <div id="group-create-overlay" class="overlay" style="display: none;"
        onclick="if(event.target===this) this.style.display='none'">
        <div class="modal" style="max-width: 400px;">
            <div style="position:absolute; top:20px; right:20px; font-size:24px; cursor:pointer; color:var(--text-dim);"
                onclick="document.getElementById('group-create-overlay').style.display='none'">‚úï</div>
            <h2>–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</h2>
            <p style="font-size:12px; color:var(--text-dim); margin-bottom:15px;">–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã —Å–º–æ–∂–µ—Ç–µ
                –¥–æ–±–∞–≤–∏—Ç—å
                —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ –∏—Ö ID.</p>
            <input type="text" id="groupNameInput" class="big-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã" maxlength="30">
            <button class="btn-main" style="margin-top:10px;"
                onclick="app.createGroup(document.getElementById('groupNameInput').value)">–°–æ–∑–¥–∞—Ç—å üöÄ</button>
        </div>
    </div>

    <!-- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (Sync Overlay) -->
    <div id="sync-overlay" class="overlay" style="display: none;">
        <div class="modal" style="max-width: 400px; text-align:center;">
            <div style="position:absolute; top:20px; right:20px; font-size:24px; cursor:pointer;"
                onclick="document.getElementById('sync-overlay').style.display='none'">‚úï</div>
            <h2>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</h2>

            <!-- Source View -->
            <div id="syncSourceView" style="display:none;">
                <p style="font-size:13px; color:var(--text-dim); margin-bottom:15px;">–í–≤–µ–¥–∏—Ç–µ <b>Source ID</b> –Ω–∞ –¥—Ä—É–≥–æ–º
                    —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:</p>
                <div id="syncCodeDisplay"
                    style="font-family: 'Courier New', Courier, monospace; font-size:15px; font-weight:bold; color:var(--accent); background:rgba(0,132,255,0.1); padding:15px; border-radius:10px; border:1px solid rgba(0,132,255,0.2); margin-bottom:20px; word-break:break-all; line-height:1.4;">
                    ------</div>
                <div id="syncSourceStatus" style="font-size:11px; color:var(--text-dim);">–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</div>
            </div>

            <!-- Target View -->
            <div id="syncTargetView" style="display:none;">
                <p style="font-size:13px; color:var(--text-dim); margin-bottom:15px;">–í—Å—Ç–∞–≤—å—Ç–µ <b>Source ID</b> —Å
                    –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</p>
                <input type="text" id="syncInputCode" class="big-input" placeholder="p2p_user_..."
                    style="text-align:center; font-size:14px; font-family: monospace;">
                <button class="btn-main" style="margin-top:15px;" onclick="app.startSyncPull()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∏
                    –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏</button>
                <div id="syncTargetStatus" style="font-size:11px; color:var(--text-dim); margin-top:15px;"></div>
            </div>
        </div>
    </div>

    <script src="js/app.js?v=1.1" defer></script>
    <script>
        // Service Worker only works over HTTP, skip for Electron (file://)
        if ('serviceWorker' in navigator && location.protocol !== 'file:') {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW Registered'))
                    .catch(err => console.log('SW Failed', err));
            });
        }
    </script>
</body>

</html>